<!doctype html>
<html>
  <head>
    <title>CodeMirror 2: MySQL mode</title>
    <link rel="stylesheet" href="../../lib/codemirror.css">
    <script src="../../lib/codemirror.js"></script>
    <script src="mysql.js"></script>
    <link rel="stylesheet" href="mysql.css">
    <link rel="stylesheet" href="../../css/docs.css">
    <style>.CodeMirror {border: 2px inset #dee;}</style>
  </head>
  <body>
    <h1>CodeMirror 2: MySQL mode</h1>

<form><textarea id="code" name="code">
-- MySQL Code Demo
/*
   based on PL/SQL, addapted to MySQL by Michal Cihar ( http://cihar.com/ )
   June 2011
*/

CREATE FUNCTION inventory_in_stock(p_inventory_id INT) RETURNS BOOLEAN
READS SQL DATA
BEGIN
    DECLARE v_rentals INT;
    DECLARE v_out     INT;

    #AN ITEM IS IN-STOCK IF THERE ARE EITHER NO ROWS IN THE rental TABLE
    #FOR THE ITEM OR ALL ROWS HAVE return_date POPULATED

    SELECT COUNT(*) INTO v_rentals
    FROM rental
    WHERE inventory_id = p_inventory_id;

    IF v_rentals = 0 THEN
      RETURN TRUE;
    END IF;

    SELECT COUNT(rental_id) INTO v_out
    FROM inventory LEFT JOIN rental USING(inventory_id)
    WHERE inventory.inventory_id = p_inventory_id
    AND rental.return_date IS NULL;

    IF v_out > 0 THEN
      RETURN FALSE;
    ELSE
      RETURN TRUE;
    END IF;
END
--
</textarea></form>

    <script>
      var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
        lineNumbers: true,
        matchBrackets: true,
        indentUnit: 4,
        mode: "text/x-mysql"
      });
    </script>

    <p>
        Simple mode that handles MySQL language.
    </p>

    <p><strong>MIME type defined:</strong> <code>text/x-mysql</code>
    (MySQL code)
</html>
